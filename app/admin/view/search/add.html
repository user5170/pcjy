{include file="common/head"/}
<style type="text/css">
    .must{
        color: red;
        font-size: 20px;
        vertical-align:-webkit-baseline-middle;
    }
    .tip{
        font-size: 20px;
        line-height: 26px;
    }

</style>
<script type="text/javascript" src="__STATIC__/ueditor/ueditor.config.js"></script>
<script type="text/javascript" src="__STATIC__/ueditor/ueditor.all.js"></script>
<div class="admin-main layui-anim layui-anim-upbit"  ng-app="hd" ng-controller="ctrl">
    <fieldset class="layui-elem-field layui-field-title">
        <legend>添加仓库</legend>
    </fieldset>
    <form class="layui-form layui-form-pane" action="add" method="post" enctype="multipart/form-data">
        <div class="layui-form-item">
            <label class="layui-form-label"><span class="must">*</span>仓库名称</label>
            <div class="layui-input-4">
                <input type="text" lay-verify="required" name="house_name" placeholder="仓库名称" class="layui-input">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label"><span class="must">*</span>仓库等级</label>
            <div class="layui-input-4">
                <select name="house_leave">
                    <option>级别</option>
                    {volist name="info.leave" id="vo"}
                        <option value="{$vo.id}">{$vo.name}</option>
                    {/volist}
                </select>
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label"><span class="must">*</span>仓库类型</label>
            <div class="layui-input-4">
                <select name="house_type">
                    {volist name="info.type" id="vo"}
                        <option value="{$vo.id}">{$vo.name}</option>
                    {/volist}
                </select>
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label"><span class="must">*</span>仓库特点</label>
            <div class="layui-input-3">
                <input type="text" name="house_spec" lay-verify="required" placeholder="仓库特点" class="layui-input">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label"><span class="must">*</span>所在地区</label>
            <div class="layui-input-inline">
                <select name="province" ng-model="field.province" lay-filter="province" ng-options="v.id as v.name for v in province" ng-selected="v.id==field.province">
                    <option value="">请选择省</option>
                </select>
            </div>
            <div class="layui-input-inline" >
                <select name="city" id="city" ng-model="field.city" lay-filter="city" ng-options="v.id as v.name for v in city" ng-selected="v.id==field.city">
                    <option value="">请选择市</option>
                </select>
            </div>
            <div class="layui-input-inline">
                <select name="district" id="district" ng-model="field.district" lay-filter="district" ng-options="v.id as v.name for v in district" ng-selected="v.id==field.district">
                    <option value="">请选择县/区</option>
                </select>
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">仓库地址</label>
            <div class="layui-input-3">
                <input type="text" name="house_address" placeholder="仓库地址"  class="layui-input">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">仓库个数</label>
            <div class="layui-input-3">
                <input type="text" name="house_num" placeholder="仓库个数"  class="layui-input">
            </div><span class="tip">个</span>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">总面积</label>
            <div class="layui-input-3">
                <input type="text" name="house_acr_count" placeholder="总面积"  class="layui-input">
            </div><span class="tip">㎡</span>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">可租面积</label>
            <div class="layui-input-3">
                <input type="text" name="house_acr_lease" placeholder="可租面积"  class="layui-input">
            </div><span class="tip">㎡</span>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">租赁价格</label>
            <div class="layui-input-3">
                <input type="text" name="house_price" placeholder="租赁价格"  class="layui-input">
            </div><span class="tip">元/天/㎡</span>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">联系电话</label>
            <div class="layui-input-3">
                <input type="tel" name="house_mobile" placeholder="联系电话"  class="layui-input" maxlength="11">
            </div><span class="tip">(格式:028-88888888)</span>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">仓库高度</label>
            <div class="layui-input-3">
                <input type="text" name="house_height" placeholder="仓库高度"  class="layui-input">
            </div><span class="tip">米</span>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">主干道宽度</label>
            <div class="layui-input-3">
                <input type="text" name="house_width" placeholder="主干道宽度"  class="layui-input">
            </div><span class="tip">米</span>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">底层承载</label>
            <div class="layui-input-3">
                <input type="text" name="house_one_foot" placeholder="底层承载"  class="layui-input">
            </div><span class="tip">吨/㎡</span>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label" style="width: 125px">二层以上承重</label>
            <div class="layui-input-3">
                <input type="text" name="house_two_foot" placeholder="二层以上承重"  class="layui-input">
            </div><span class="tip">吨/㎡</span>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">其余费用</label>
            <div class="layui-input-3">
                <input type="text" name="house_estate" placeholder="其余费用"  class="layui-input">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">服务</label>
            <div class="layui-input-3">
                <input type="text" name="house_serve" placeholder="服务"  class="layui-input">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">卸货平台</label>
            <div class="layui-input-3">
                <input type="text" name="house_unload" placeholder="卸货平台"  class="layui-input">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">保安系统</label>
            <div class="layui-input-3">
                <input type="text" name="house_ensure" placeholder="保安系统"  class="layui-input">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">月台</label>
            <div class="layui-input-3">
                <input type="radio" name="house_platform" class="layui-input" lay-filter="menustatus" checked value="1" title="有">
                <input type="radio" name="house_platform" class="layui-input" lay-filter="menustatus"  value="2" title="无">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">雨棚</label>
            <div class="layui-input-3">
                <input type="radio" name="house_canopy" class="layui-input" lay-filter="menustatus" checked value="1" title="有">
                <input type="radio" name="house_canopy" class="layui-input" lay-filter="menustatus"  value="2" title="无">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label"  style="width: 125px">合作开始时间</label>
            <div class="layui-input-3">
                <input type="text" name="house_b_time" placeholder="合作开始时间" id="test1"  class="layui-input">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label"  style="width: 125px">合作结束时间</label>
            <div class="layui-input-3">
                <input type="text" name="house_e_time" placeholder="合作结束时间" id="test2"  class="layui-input">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">地坪</label>
            <div class="layui-input-3">
                <select name="house_terrace">
                    {volist name="info.terrace" id="vo"}
                        <option value="{$vo.id}">{$vo.name}</option>
                    {/volist}
                </select>
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">开发商</label>
            <div class="layui-input-3">
                <input type="text" name="house_developers" placeholder="开发商"  class="layui-input">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">模式</label>
            <div class="layui-input-3">
                <select name="house_pattern" style="z-index: 1000">
                    {volist name="info.pattern" id="vo"}
                        <option value="{$vo.id}" style="z-index: 1000">{$vo.name}</option>
                    {/volist}
                </select>
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">仓库图片</label>
            <div class="layui-input-3 picDiv">
                <input type="file" name="house_pic[]" placeholder="详细说明" class="layui-input file" id="fileInput" multiple accept="image/png, image/jpeg, image/gif, image/jpg">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label"><span class="must">*</span>添加人</label>
            <div class="layui-input-3">
                <input type="text" name="house_username" placeholder="添加人"  class="layui-input">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">信息状态</label>
            <div class="layui-input-3">
                <input type="radio" name="house_stas" class="layui-input" lay-filter="menustatus" checked value="1" title="通过">
                <input type="radio" name="house_stas" class="layui-input" lay-filter="menustatus"  value="2" title="待审">
                <input type="radio" name="house_stas" class="layui-input" lay-filter="menustatus"  value="3" title="拒绝">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">浏览次数</label>
            <div class="layui-input-3">
                <input type="number" name="house_history" placeholder="浏览次数"  class="layui-input">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">热度</label>
            <div class="layui-input-3">
                <input type="number" name="house_hot" placeholder="热度"  class="layui-input">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">备注</label>
            <div class="layui-input-3 picDiv">
                <textarea name="house_remark" placeholder="备注" class="layui-textarea"></textarea>
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">详细说明</label>
            <div class="layui-input-3" style="width: 500px;">
                <textarea id="tarea" name="discripArea" style=" width: 100%; display: none"></textarea>
                <script id="editor1" type="text/plain"></script>
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">地图标注</label>
            <div class="layui-input-3"  style="width: 600px">
                {include file="common/map"/}
            </div>
        </div>
        <div class="layui-form-item">
            <div class="layui-input-block">
                <input type="submit" value="提交" class="layui-btn">
                <button type="reset" class="layui-btn layui-btn-primary">重置信息</button>
            </div>
        </div>
    </form>
</div>
{include file="common/foot"/}
<script type="text/javascript" src="__STATIC__/common/js/jquery.2.1.1.min.js"></script>
<script src="__STATIC__/common/js/angular.min.js"></script>
<script>
//图片上传预览功能
var userAgent = navigator.userAgent; //用于判断浏览器类型

$(".file").change(function() {
    //获取选择图片的对象
    var docObj = $(this)[0];
    var picDiv = $(this).parents(".picDiv");
    //得到所有的图片文件
    var fileList = docObj.files;
    //循环遍历
    for (var i = 0; i < fileList.length; i++) {
        //动态添加html元素
        var picHtml = "<div class='imageDiv' > <img id='img" + fileList[i].name + "' /> <div class='cover'><button class='delbtn'>删除</button></div></div>";
        console.log(picHtml);
        picDiv.prepend(picHtml);
        //获取图片imgi的对象
        var imgObjPreview = document.getElementById("img" + fileList[i].name);
        if (fileList && fileList[i]) {
            //图片属性
            imgObjPreview.style.display = 'block';
            imgObjPreview.style.width = '160px';
            imgObjPreview.style.height = '130px';
            //imgObjPreview.src = docObj.files[0].getAsDataURL();
            //火狐7以上版本不能用上面的getAsDataURL()方式获取，需要以下方式
            if (userAgent.indexOf('MSIE') == -1) {
                //IE以外浏览器
                imgObjPreview.src = window.URL.createObjectURL(docObj.files[i]); //获取上传图片文件的物理路径;
                console.log(imgObjPreview.src);
                // var msgHtml = '<input type="file" id="fileInput" multiple/>';
            } else {
                //IE浏览器
                if (docObj.value.indexOf(",") != -1) {
                    var srcArr = docObj.value.split(",");
                    imgObjPreview.src = srcArr[i];
                } else {
                    imgObjPreview.src = docObj.value;
                }
            }
        }
    }

    /*删除功能*/
    $(".delbtn").click(function() {
        var _this = $(this);
        _this.parents(".imageDiv").remove();
    });
});
</script>
<script>
    var m = angular.module('hd',[]);
    m.controller('ctrl',function($scope) {
        $scope.province = {$province};
        $scope.city = {$city};
        $scope.district = {$district};
        layui.use('laydate', function(){
          var laydate = layui.laydate;
          
          //执行一个laydate实例
          laydate.render({
            elem: '#test1', //指定元素
          });
          laydate.render({
            elem: '#test2', //指定元素
          });
        });
        layui.use(['form', 'layer'], function () {
            var form = layui.form, layer = layui.layer,$= layui.jquery;
            form.on('select(province)', function(data) {
                var pid = data.value;
                var loading = layer.load(1, {shade: [0.1, '#fff']});
                $.get("{:url('getRegion')}?pid=" + pid, function (data) {
                    layer.close(loading);
                    var html='<option value="">请选择市</option>';
                    $.each(data, function (i, value) {
                        html += '<option value="text:'+value.id+'">'+value.name+'</option>';
                    });
                    $('#city').html(html);
                    $('#district').html('<option value="">请选择县/区</option>');
                    form.render()
                });
            });
            form.on('select(city)', function(data) {
                var pid = data.value;
                var loading = layer.load(1, {shade: [0.1, '#fff']});
                $.get("{:url('getRegion')}?pid=" + pid, function (data) {
                    layer.close(loading);
                    var html='<option value="">请选择县/区</option>';
                    $.each(data, function (i, value) {
                        html += '<option value="text:'+value.id+'">'+value.name+'</option>';
                    });
                    $('#district').html(html);

                    form.render()
                });
            });
        });
    });
</script>
<script>
    UE.getEditor('editor1').addListener("selectionchange",function(){
        changeElement('content');
    });
    function changeElement(name){
        if(name == 'content'){
            var content = UE.getEditor('editor1').getContent();
            $("#tarea").val(content);
        }
    }
</script>
